<!-- Copyright(c) Maarten van Stam All rights reserved. */ -->

<Project Sdk="Microsoft.NET.Sdk.Web">

	<PropertyGroup>
    <TargetFramework>net10.0</TargetFramework>
		<Nullable>enable</Nullable>
		<ImplicitUsings>enable</ImplicitUsings>
		<TargetOfficeVersion>16.0</TargetOfficeVersion>

    <!-- Build quality and determinism -->
    <AnalysisLevel>latest</AnalysisLevel>
    <EnforceCodeStyleInBuild>true</EnforceCodeStyleInBuild>
    <Deterministic>true</Deterministic>
    <IsPackable>false</IsPackable>
    <!-- Optional: treat warnings as errors in Release -->
  </PropertyGroup>

	<ItemGroup>
		<ProjectReference Include="..\Blazor.Word.AddIn.Client\Blazor.Word.AddIn.Client.csproj" />
		
		<PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.Server" Version="10.0.0-rc.2.25502.107" />
		<PackageReference Include="Microsoft.FluentUI.AspNetCore.Components" Version="4.13.1" />
		<PackageReference Include="Microsoft.FluentUI.AspNetCore.Components.Icons" Version="4.13.1" />
	</ItemGroup>

  <!-- Incremental, reproducible npm restore -->
  <Target Name="NpmRestore"
          BeforeTargets="Build"
          Inputs="package-lock.json"
          Outputs="node_modules/.package-lock.stamp">
    <Message Importance="high" Text="Running npm ci (only when package-lock.json changes)..." />
    <Exec Command="npm ci"
          Condition="Exists('package.json') and Exists('package-lock.json')" />
    <Touch Files="node_modules/.package-lock.stamp" AlwaysCreate="true" />
  </Target>

  <!-- 
  Only run npm start-local when in Debug configuration and building inside Visual Studio (F5)
  There is no option to only check on actually running the project, so we approximate this by checking if building inside Visual Studio in Debug configuration.
  -->
  <Target Name="StartLocalDev" AfterTargets="Build">
    <Message Importance="high" Text="Skipping Run Start Local: Configuration=$(Configuration), Building Inside VisualStudio=$(BuildingInsideVisualStudio), CI=$(CI)"
             Condition="'$(Configuration)'!='Debug' or '$(BuildingInsideVisualStudio)'!='true' or '$(CI)'=='true'" />
    
    <Exec Command="npm run start-local" 
          Condition="'$(Configuration)'=='Debug' and '$(BuildingInsideVisualStudio)'=='true' and '$(CI)'!='true'" />
  </Target>
  
</Project>
